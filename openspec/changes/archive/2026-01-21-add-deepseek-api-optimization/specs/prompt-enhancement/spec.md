# prompt-enhancement Spec Delta

## MODIFIED Requirements

### Requirement: Prompt Enhancement Logic

The application MUST support two distinct prompt enhancement modes: static prefix (common sense) and AI-powered (DeepSeek optimization).

**Acceptance Criteria:**
- **Common Sense Mode (Static):**
  - Prefix: "你是专家 " (with trailing space)
  - Suffix: " 请提供主要观点的3个不同出处的网页链接以便我查验。如果你不知道或查不到,就实说,不要编造"
  - Format: `{prefix}{userPrompt}{suffix}`
  - Triggered by "查询常识" button
  - No external API calls
  - Instant response (synchronous)

- **AI-Powered Mode (DeepSeek):**
  - Prefix: Dynamically generated by DeepSeek API (domain-specific expert)
  - Suffix: Same as common sense mode
  - Format: `{dynamicPrefix} {optimizedPrompt}{suffix}`
  - Triggered by "应对未知与复杂" button
  - Calls `/api/optimize` endpoint
  - Async response (1-5 seconds)
  - Includes fluency and punctuation optimization

- **Shared Behavior:**
  - Both modes use identical suffix text
  - Both modes validate input (no empty/whitespace prompts)
  - Both modes clear textarea after success
  - Both modes append to same output area (with visual distinction)

#### Scenario: User Uses Common Sense Mode

**Given** the user enters prompt "什么是机器学习"
**When** the user clicks the "查询常识" button
**Then** the enhanced prompt is generated instantly with static prefix
**And** the result is: "你是专家 什么是机器学习 请提供主要观点的3个不同出处的网页链接以便我查验。如果你不知道或查不到,就实说,不要编造"
**And** no API call is made
**And** the prompt is displayed with orange border and "常识" badge

#### Scenario: User Uses AI-Powered Mode

**Given** the user enters prompt "请问氛围编程这个提法是谁在什么时候提出的"
**When** the user clicks the "应对未知与复杂" button
**Then** an API call is made to `/api/optimize`
**And** the DeepSeek API analyzes the prompt domain
**And** a domain-specific prefix is generated (e.g., "你是 AI 辅助软件开发专家")
**And** the optimized result includes the dynamic prefix and improved punctuation
**And** the prompt is displayed with blue/purple border and "AI优化" badge

#### Scenario: User Alternates Between Modes

**Given** the user has generated 2 prompts using "查询常识"
**And** then generates 1 prompt using "应对未知与复杂"
**And** then generates 1 more using "查询常识"
**When** viewing the output area
**Then** all 4 prompts are displayed in chronological order
**And** prompts 1, 2, 4 show orange border and "常识" badge
**And** prompt 3 shows blue/purple border and "AI优化" badge
**And** the visual distinction is immediately clear

---

### Requirement: Enhanced Prompt Storage and Display

The application MUST store all enhanced prompts (from both modes) in chronological order with metadata indicating the enhancement type.

**Acceptance Criteria:**
- Prompts are stored with type: `'static' | 'ai-powered'`
- Data structure: `Array<{text: string, type: 'static' | 'ai-powered', timestamp?: number}>`
- Both types are appended to the same array in order
- Display shows visual distinction based on type
- No limit on number of prompts (within browser memory)

#### Scenario: Storage Includes Enhancement Type

**Given** the user generates a static prompt and an AI-powered prompt
**When** viewing the React state
**Then** the state array contains:
```javascript
[
  {text: "你是专家 什么是机器学习...", type: "static"},
  {text: "你是 AI 辅助软件开发专家 请问氛围编程...", type: "ai-powered"}
]
```

#### Scenario: Display Differentiates by Type

**Given** the output area contains prompts of both types
**When** rendering the prompts
**Then** each prompt's visual style is determined by its `type` property
**And** static prompts show orange theme
**And** AI-powered prompts show blue/purple theme

---
